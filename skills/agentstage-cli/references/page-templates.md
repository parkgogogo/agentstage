# Page Templates

## Basic Bridge Store Page (Counter)

This is the default template generated by `agentstage add-page <name>`:

```typescript
import { z } from 'zod';
import { createFileRoute } from '@tanstack/react-router';
import { createBridgeStore } from '@agentstage/bridge/browser';
import { Button } from '../components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../components/ui/card';

// Define the page state schema
const StateSchema = z.object({
  count: z.number().default(0),
});

type State = z.infer<typeof StateSchema>;

// Create the bridge store for this page
const bridgeStore = createBridgeStore<State, { increment: { payload?: number }; decrement: {} }>({
  pageId: 'counter',
  storeKey: 'main',
  description: {
    schema: StateSchema,
    actions: {
      increment: {
        description: 'Increment the counter by a specified amount (default: 1)',
        payload: z.number().optional(),
      },
      decrement: {
        description: 'Decrement the counter by 1',
      },
    },
  },
  createState: (set) => ({
    count: 0,
    dispatch: (action) => {
      switch (action.type) {
        case 'increment':
          set((state) => ({ count: state.count + (action.payload ?? 1) }));
          break;
        case 'decrement':
          set((state) => ({ count: state.count - 1 }));
          break;
      }
    },
  }),
});

export const Route = createFileRoute('/counter')({
  component: CounterPage,
});

function CounterPage() {
  // Connect to the bridge when the component mounts
  if (typeof window !== 'undefined') {
    bridgeStore.connect().catch(console.error);
  }

  return (
    <div className="min-h-screen bg-background p-8">
      <div className="mx-auto max-w-2xl">
        <Card>
          <CardHeader>
            <CardTitle>Counter</CardTitle>
            <CardDescription>
              This page is connected to the Agentstage Bridge.
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <p className="text-sm text-muted-foreground">
              Edit this page at src/routes/counter.tsx
            </p>
            <div className="flex gap-2">
              <Button variant="outline">Action 1</Button>
              <Button>Action 2</Button>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

## Form Page Pattern

For pages that handle form data:

```typescript
import { z } from 'zod';
import { createFileRoute } from '@tanstack/react-router';
import { createBridgeStore } from '@agentstage/bridge/browser';
import { Button } from '../components/ui/button';
import { Input } from '../components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card';

const StateSchema = z.object({
  data: z.object({
    name: z.string().default(''),
    email: z.string().default(''),
  }),
  isSubmitting: z.boolean().default(false),
});

type State = z.infer<typeof StateSchema>;

const bridgeStore = createBridgeStore<State, {
  updateField: { payload: { field: string; value: string } };
  submit: {};
  setSubmitting: { payload: boolean };
}>({
  pageId: 'form-page',
  storeKey: 'main',
  description: {
    schema: StateSchema,
    actions: {
      updateField: {
        description: 'Update form field value',
        payload: z.object({ field: z.string(), value: z.string() }),
      },
      submit: {
        description: 'Submit the form',
      },
      setSubmitting: {
        description: 'Set submitting state',
        payload: z.boolean(),
      },
    },
  },
  createState: (set, get) => ({
    data: { name: '', email: '' },
    isSubmitting: false,
    dispatch: (action) => {
      switch (action.type) {
        case 'updateField':
          set((state) => ({
            data: { ...state.data, [action.payload.field]: action.payload.value },
          }));
          break;
        case 'setSubmitting':
          set({ isSubmitting: action.payload });
          break;
        case 'submit':
          // Handle form submission
          console.log('Submitting:', get().data);
          break;
      }
    },
  }),
});

export const Route = createFileRoute('/form-page')({
  component: FormPage,
});

function FormPage() {
  if (typeof window !== 'undefined') {
    bridgeStore.connect().catch(console.error);
  }

  return (
    <div className="min-h-screen bg-background p-8">
      <div className="mx-auto max-w-2xl">
        <Card>
          <CardHeader>
            <CardTitle>Form Page</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <Input placeholder="Name" />
            <Input placeholder="Email" type="email" />
            <Button>Submit</Button>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

## List/CRUD Page Pattern

For managing a list of items:

```typescript
import { z } from 'zod';
import { createFileRoute } from '@tanstack/react-router';
import { createBridgeStore } from '@agentstage/bridge/browser';
import { Button } from '../components/ui/button';
import { Input } from '../components/ui/input';
import { Card, CardContent } from '../components/ui/card';

const ItemSchema = z.object({
  id: z.string(),
  text: z.string(),
  completed: z.boolean(),
});

const StateSchema = z.object({
  items: z.array(ItemSchema).default([]),
  newItemText: z.string().default(''),
});

type State = z.infer<typeof StateSchema>;

const bridgeStore = createBridgeStore<State, {
  addItem: {};
  removeItem: { payload: string };
  toggleItem: { payload: string };
  setNewItemText: { payload: string };
}>({
  pageId: 'todo-list',
  storeKey: 'main',
  description: {
    schema: StateSchema,
    actions: {
      addItem: {
        description: 'Add a new item to the list',
      },
      removeItem: {
        description: 'Remove item by ID',
        payload: z.string(),
      },
      toggleItem: {
        description: 'Toggle item completion status',
        payload: z.string(),
      },
      setNewItemText: {
        description: 'Set text for new item',
        payload: z.string(),
      },
    },
  },
  createState: (set, get) => ({
    items: [],
    newItemText: '',
    dispatch: (action) => {
      switch (action.type) {
        case 'addItem':
          set((state) => ({
            items: [
              ...state.items,
              { id: crypto.randomUUID(), text: state.newItemText, completed: false },
            ],
            newItemText: '',
          }));
          break;
        case 'removeItem':
          set((state) => ({
            items: state.items.filter((i) => i.id !== action.payload),
          }));
          break;
        case 'toggleItem':
          set((state) => ({
            items: state.items.map((i) =>
              i.id === action.payload ? { ...i, completed: !i.completed } : i
            ),
          }));
          break;
        case 'setNewItemText':
          set({ newItemText: action.payload });
          break;
      }
    },
  }),
});

export const Route = createFileRoute('/todo-list')({
  component: TodoListPage,
});

function TodoListPage() {
  if (typeof window !== 'undefined') {
    bridgeStore.connect().catch(console.error);
  }

  return (
    <div className="min-h-screen bg-background p-8">
      <div className="mx-auto max-w-2xl space-y-4">
        <Card>
          <CardContent className="pt-6 space-y-4">
            <div className="flex gap-2">
              <Input placeholder="New item..." />
              <Button>Add</Button>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

## Key Differences from Old Architecture

### 1. Bridge Store Connection

**New pattern** (Vite + single port):
```typescript
// Connect to the bridge when the component mounts
if (typeof window !== 'undefined') {
  bridgeStore.connect().catch(console.error);
}
```

### 2. Import Paths

Always use relative paths for components:
```typescript
import { Button } from '../components/ui/button';
```

### 3. Route Export

Use `createFileRoute` from `@tanstack/react-router`:
```typescript
export const Route = createFileRoute('/my-page')({
  component: MyPage,
});
```

### 4. State Updates

Use functional updates for state that depends on previous state:
```typescript
set((state) => ({ count: state.count + 1 }));
```

## Type Checking

After editing any page file, run:

```bash
npm run type-check
```

This ensures:
- TypeScript types are correct
- Bridge Store actions match their definitions
- Component imports are valid
